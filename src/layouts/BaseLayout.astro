---
import Background from "../components/Background.astro";
import "../styles/global.scss";
import { Icon } from "astro-icon/components";

interface Props {
  title?: string;
  description?: string;
  hasImages?: boolean;
  hasMath?: boolean;
}

const { title, description, hasImages = false, hasMath = false } = Astro.props;
const currentPath = Astro.url.pathname;
const siteTitle = "John Choque";
const siteUrl = Astro.site?.toString() || "https://johnchque.com";
const pageTitle = title ? `${title} | ${siteTitle}` : siteTitle;
const ogImage = `${siteUrl}/og-image.jpg`; // Add your actual OG image
---

<!doctype html>
<html lang="en" data-bs-theme="white">
  <head>
    <!-- Core meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{pageTitle}</title>
    <meta name="author" content="John Choque" />
    {description && <meta name="description" content={description} />}

    <!-- CRITICAL: Anti-flash script - must be first -->
    <script is:inline>
      (function () {
        const theme =
          localStorage.getItem("theme") ||
          (window.matchMedia("(prefers-color-scheme: dark)").matches
            ? "dark"
            : "white");
        document.documentElement.setAttribute("data-bs-theme", theme);
      })();
    </script>

    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" />

    <!-- Performance: Preload critical fonts -->
    <link
      rel="preload"
      href="/assets/fonts/royalty_free.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/assets/fonts/PTSerif.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />
    <link
      rel="preload"
      href="/assets/fonts/libre-baskerville-400.woff2"
      as="font"
      type="font/woff2"
      crossorigin
    />
    <link
      rel="preload"
      href="/assets/fonts/Literata.ttf"
      as="font"
      type="font/ttf"
      crossorigin
    />

    <!-- Theme colors -->
    <meta
      name="theme-color"
      content="#274b75"
      media="(prefers-color-scheme: light)"
    />
    <meta
      name="theme-color"
      content="#151616"
      media="(prefers-color-scheme: dark)"
    />

    <!-- Open Graph -->
    <meta property="og:site_name" content={siteTitle} />
    <meta property="og:url" content={`${siteUrl}${Astro.url.pathname}`} />
    <meta property="og:type" content="website" />
    <meta property="og:image" content={ogImage} />
    {title && <meta property="og:title" content={title} />}
    {description && <meta property="og:description" content={description} />}

    <!-- Stylesheets -->
    {
      hasMath && (
        <link
          rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
          integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV"
          crossorigin="anonymous"
        />
      )
    }
  </head>
  <body>
    <Background />
    <div class="layout">
      <nav class="sidebar">
        <ul>
          <li>
            <a class="page-scroll" href="#" id="btnSwitch"
              ><Icon name="moon" /></a
            >
          </li>
          <li>
            <a href="/" class={currentPath === "/" ? "active" : ""}>home</a>
          </li>
          <li>
            <a
              href="/notes"
              class={currentPath.startsWith("/notes") ? "active" : ""}>garden</a
            >
          </li>
          <li>
            <a
              href="/workbench"
              class={currentPath.startsWith("/workbench") ? "active" : ""}
              >work</a
            >
          </li>
          <li>
            <a
              href="/bio"
              class={currentPath.startsWith("/bio") ? "active" : ""}>about</a
            >
          </li>
        </ul>
      </nav>

      <main id="main-content" role="main">
        <slot />
      </main>
      <a
        href="#body"
        class="back-to-top page-scroll"
        id="btt-button"
        aria-label="Back to top"
      >
        <Icon name="arrow-up" />
      </a>
    </div>
    <!-- Scripts -->
    <script src="../scripts/scripts.js"></script>
    {
      hasImages && (
        <script
          src="https://cdnjs.cloudflare.com/ajax/libs/fslightbox/3.0.9/index.min.js"
          integrity="sha512-03Ucfdj4I8Afv+9P/c9zkF4sBBGlf68zzr/MV+ClrqVCBXWAsTEjIoGCMqxhUxv1DGivK7Bm1IQd8iC4v7X2bw=="
          crossorigin="anonymous"
          referrerpolicy="no-referrer"
        />
      )
    }
  </body>
</html>
