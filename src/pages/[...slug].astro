---
// src/pages/notes/[...slug].astro
import { getCollection, render } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";

export async function getStaticPaths() {
  const notes = await getCollection("notes");
  const worldNotes = await getCollection("world");
  
  const allNotes = [...notes, ...worldNotes];

  return allNotes.map((note) => ({
    params: { slug: note.id },
    props: { note },
  }));
}

const { note } = Astro.props;
const { Content } = await render(note);

// Helper function to get icon based on category
function getCategoryIcon(category: string): string {
  const icons: Record<string, string> = {
    Learning: "ri-book-2-fill",
    Seedling: "ri-seedling-fill",
    Budding: "ri-plant-fill",
    Evergreen: "ri-tree-fill",
    Now: "ri-time-line",
    Reflections: "ri-lightbulb-line",
  };
  return icons[category] || "ri-leaf-fill";
}

// Format date
const updatedDate = note.data.updated || note.data.date;
const formattedDate = new Date(updatedDate).toLocaleDateString("en-US", {
  year: "numeric",
  month: "long",
  day: "numeric",
});
---

<BaseLayout
  title={note.data.title}
  description={note.data.description}
  hasMath={true}
  hasImages={true}
>
  <div class="container">
    <div class="row justify-content-start mb-4 ml-top-padding">
      <article class="heading-title col-12 col-lg-7">
        <header class="row align-items-start my-5">
          <nav class="col" aria-label="Breadcrumb">
            <a href="/notes">
              <i class="ri-arrow-left-line"></i><em>Notes</em>
            </a>
          </nav>
          <div class="col-1 text-end">
            <a class="page-scroll" href="#" id="btnSwitch">
              <i class="ri-moon-line"></i>
            </a>
          </div>
        </header>

        <h1>{note.data.title}</h1>
        <p class="subtitle">{note.data.description}</p>
        <p class="text-muted">
          Last tended: {formattedDate}
        </p>
        <section class="note-content">
          <Content />
        </section>

        {
          note.data.tags && note.data.tags.length > 0 && (
            <div class="tags mt-4">
              <p class="text-muted mb-2">Tags:</p>
              {note.data.tags.map((tag) => (
                <span class="badge bg-secondary me-2">{tag}</span>
              ))}
            </div>
          )
        }
      </article>
    </div>
  </div>
</BaseLayout>
